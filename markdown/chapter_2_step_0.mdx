## Introduction

In the previous chapters, you learned how to process inputs, generate outputs, and manage application state.
In this chapter, you will learn how to **deal with assets** and understand how value enters a Cartesi Rollups application.

# Chapter 3: Opening Gifts – Dealing with Assets

## Step 1: Handling Deposits

### Deposits and Portals

When a regular input is sent to a Cartesi Rollups application, the sender address contained in `data["metadata"]["msg_sender"]` is the account that signed the transaction.

**Deposits are different.**

When assets are deposited, the transaction is sent to a **portal contract**. The portal contract then notifies the application, which means:

* The `msg_sender` in the metadata is **the portal contract address**, not the user
* The user’s address and the deposited value are encoded in the **payload**

Because of this, deposits must be identified by reading the **metadata**, not just the payload.

### Payload Format

For ETH deposits, the payload has a fixed format:

```
[address][value]
```

* `address`: 20 bytes (40 hex characters)
* `value`: 32 bytes (64 hex characters), encoded in **wei**

Since the deposited value is expressed in wei, it must be handled as a **BigInt**.

### Objective

Detect ETH deposits, decode the payload, and update the application’s ETH balance.

### User Instructions

* **Code Editing Guidelines**: Only modify the sections explicitly marked for changes. Keep everything else intact.
* **Task**: Check whether the advance request comes from the ETH portal and, if so, decode and process the deposit.

### Required Modification

Inside `handle_advance`, you must:

1. Check the `msg_sender` field in the metadata - data["metadata"]["msg_sender"]
  - You need `data["metadata"]["msg_sender"] == "0xFfdbe43d4c855BF7e0f105c400A50857f53AB044"` to be truth
2. Extract the user address and deposited amount from the payload
  - You can use data["payload"].slice(2, 42) and data["payload"].slice(42, 106)
3. Convert the deposited value to `BigInt`
  - Remember the value you read does not have the "0x" prefix, you might need to add it.
4. Update the application’s wei balance

### State Variable

The application already defines a balance variable:

```js
let wei = BigInt(0)
```

This variable persists across inputs and accumulates the total deposited ETH.
