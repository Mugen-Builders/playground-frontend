## Introduction

In the previous step, you learned how assets enter a Cartesi Rollups application through deposits.
In this step, you will learn how assets **leave** the application by creating **vouchers**.

# Chapter 3: Opening Gifts – Dealing with Assets

## Step 2: Withdrawing Assets with Vouchers

### Vouchers and Base Layer Interaction

Vouchers are a special type of output that allow a Cartesi Rollups application to **interact with the base layer**.

While notices and reports are informational, vouchers are **actionable**. They instruct a smart contract on the base layer to execute a transaction on behalf of the application.

Withdrawals work by creating a voucher that tells the **application contract** to transfer previously deposited assets on the **portal contract** to a recipient.

### Voucher Structure

A voucher consists of two fields:

* **destination**: the address of the contract that will be called on the base layer
* **payload**: the encoded function call data

The payload format follows standard EVM encoding:

* The first 4 bytes are the **keccak hash** of the function signature
* The remaining bytes are the encoded function arguments

To simplify this process, the template provides an auxiliary function:

```js
createEtherWithdrawlPayload(userAddress, amountWei)
```

This function builds the correct payload for an ETH withdrawal.

In case you are curious the prefix show "0x522f6815" if for the `withdrawEther(address,uint256)` function on the Application Contract. This moves the assets from the portals contract to the recipient.

### Objective

Create a voucher that withdraws ETH from the application and sends it to the caller.

### User Instructions

* **Code Editing Guidelines**: Only modify the sections explicitly marked for changes. Keep everything else intact.
* **Task**: Decrease the application balance and create a voucher that triggers an ETH withdrawal.

### Required Modification

Inside `handle_advance`, you must:

1. Read the withdrawal amount from the payload
    - Remember to convert it to BigInt
2. Decrease the application’s balance
3. Create a voucher targeting the application contract, which in turn calls portal contract
    - The voucher structure consists of `destination` and `payload`
4. Send the voucher to the rollup node
```js 
await fetch(`${rollup_server}/voucher`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(voucher),
});
```

### State Update

The application starts with an initial balance:

```js
let wei = 1000000000000000000000n; // 1000 ETH initial balance
```

Each withdrawal reduces this balance accordingly.

## Sign the transaction
To claim your prize sign the transaction at the end of this chapter to prove you completed it! 

- First connect you wallet (on the top right of this page)
- You will need SepoliaETH.
  - You can get some at a faucet like this one: https://www.alchemy.com/faucets/ethereum-sepolia